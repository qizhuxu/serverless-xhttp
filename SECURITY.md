# 安全配置指南

## 安全增强功能

本项目已实现多层安全防护机制，以下是详细说明和配置建议。

## 🛡️ 已实现的安全特性

### 1. 主页伪装
- ✅ 专业的云服务监控平台界面
- ✅ 完全隐藏代理服务特征
- ✅ 响应式设计，看起来像正规服务

### 2. 访问频率限制
- ✅ 默认启用，每IP每分钟最多100次请求
- ✅ 自动清理过期记录，防止内存泄漏
- ✅ 可通过环境变量 `ENABLE_RATE_LIMIT=false` 关闭

### 3. 可疑请求检测
- ✅ 自动检测路径遍历、XSS、SQL注入等攻击
- ✅ 检测常见扫描器特征（WordPress、phpMyAdmin等）
- ✅ 返回标准404响应，不暴露服务信息

### 4. 订阅路径保护
- ✅ 支持令牌验证（可选）
- ✅ 无效令牌返回404，不暴露订阅功能
- ✅ 可自定义订阅路径

### 5. 服务器指纹伪装
- ✅ 伪装成 nginx/1.24.0
- ✅ 标准HTTP响应头
- ✅ 不暴露Node.js特征

### 6. UUID验证
- ✅ 严格的UUID验证机制
- ✅ 无效UUID直接拒绝连接

## 🔧 推荐安全配置

### 基础配置（必须）

```bash
# 1. 修改默认UUID（强烈推荐）
export UUID="your-unique-uuid-here"

# 2. 自定义XPATH路径（推荐使用随机字符串）
export XPATH="x8k2m9p4"

# 3. 自定义订阅路径（不要使用默认的'sub'）
export SUB_PATH="my-custom-path-2024"
```

### 高级配置（推荐）

```bash
# 4. 启用订阅令牌验证（强烈推荐）
export SUB_TOKEN="your-secret-token-here"

# 订阅链接格式变为：
# https://your-domain.com/my-custom-path-2024?token=your-secret-token-here

# 5. 自定义节点名称
export NAME="MySecureNode"

# 6. 设置域名（使用CDN时必须）
export DOMAIN="your-domain.com"

# 7. 关闭日志（生产环境推荐）
export LOG_LEVEL="none"
```

### 可选配置

```bash
# 关闭访问频率限制（不推荐，除非有特殊需求）
export ENABLE_RATE_LIMIT=false

# 修改端口
export PORT=8080
```

## 🚀 部署建议

### 1. 使用CDN（强烈推荐）
- 使用Cloudflare等CDN隐藏真实IP
- 启用CDN的DDoS防护
- 配置合适的缓存规则

### 2. 使用HTTPS
- 申请有效的SSL证书
- 强制HTTPS访问
- 配置HSTS头

### 3. 防火墙配置
```bash
# 只开放必要端口
ufw allow 443/tcp
ufw allow 80/tcp
ufw enable
```

### 4. 定期更新
- 定期更新Node.js版本
- 更新依赖包
- 关注安全公告

## 📊 安全等级评估

### 当前配置（默认）
```
安全等级: ⭐⭐⭐ (中等)
- ✅ 主页伪装
- ✅ 频率限制
- ✅ 攻击检测
- ⚠️ 使用默认UUID
- ⚠️ 使用默认路径
- ❌ 无订阅令牌
```

### 推荐配置
```
安全等级: ⭐⭐⭐⭐⭐ (高)
- ✅ 主页伪装
- ✅ 频率限制
- ✅ 攻击检测
- ✅ 自定义UUID
- ✅ 自定义路径
- ✅ 订阅令牌验证
- ✅ CDN保护
- ✅ HTTPS加密
```

## ⚠️ 安全注意事项

### 不要做的事
1. ❌ 不要在公开场合分享你的UUID
2. ❌ 不要使用默认的订阅路径
3. ❌ 不要在不信任的网络环境下使用
4. ❌ 不要将订阅链接分享给他人
5. ❌ 不要在日志中记录敏感信息

### 应该做的事
1. ✅ 定期更换UUID和令牌
2. ✅ 使用强随机字符串作为路径
3. ✅ 启用所有安全特性
4. ✅ 使用CDN和HTTPS
5. ✅ 定期检查访问日志
6. ✅ 保持软件更新

## 🔍 监控和审计

### 查看可疑访问
```bash
# 如果启用了日志
export LOG_LEVEL="warn"

# 查看日志
docker logs -f vless-proxy | grep "warn\|error"
```

### 监控指标
- 异常高频访问
- 404错误率突增
- 可疑路径访问
- 频率限制触发次数

## 📞 安全事件响应

如果发现安全问题：
1. 立即更换UUID和所有令牌
2. 修改所有自定义路径
3. 检查访问日志
4. 考虑更换服务器IP
5. 更新客户端配置

## 🔄 定期维护

建议每月执行：
- [ ] 更换UUID
- [ ] 更换订阅令牌
- [ ] 更换自定义路径
- [ ] 检查系统更新
- [ ] 审查访问日志
- [ ] 测试所有安全特性

---

**记住：安全是一个持续的过程，不是一次性的配置！**
